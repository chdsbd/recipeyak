#!/usr/bin/env bash
set -e

cd $(dirname $(dirname "$0"))

if [[ -f ../.env ]]; then
    # export all variables from env file
    set -a
    source ../.env
    set +a
fi

# ensure grep doesn't return exit code 1 on no match
c1grep() {
  grep "$@" || test $? = 1
}

node scripts/lint.js

GLOB="^src.*\.(ts|tsx)$"

FILES=$(git diff --name-only master | sed -e "s%frontend/%%"| c1grep -E "$GLOB")

if [[ -n "$FILES" ]]; then
  exit 0
fi

$(yarn bin)/tslint --project ./tsconfig.json --format 'codeFrame' $FILES

s/fmt --list-different

$(yarn bin)/tsc --noEmit
