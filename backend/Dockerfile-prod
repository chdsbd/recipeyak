FROM python:3.6-alpine
ENV PYTHONUNBUFFERD 1

# Install psycopg2 (this way reduces the docker image size)
# we only need libpq at runtime
RUN apk add --no-cache --virtual .build-deps build-base postgresql-dev && \
    apk add --no-cache libpq && \
    pip install psycopg2 && \
    apk del .build-deps

# https://github.com/kennethreitz/pipenv/blob/28cfe633c6dd81943cf84deac9f4d1daead68890/Dockerfile
# -- Install Pipenv:
RUN set -ex && pip install pipenv --upgrade

# -- Install Application into container:
RUN set -ex && mkdir /app

WORKDIR /app

# -- Adding Pipfiles
COPY Pipfile Pipfile
COPY Pipfile.lock Pipfile.lock

# -- Install dependencies:
RUN set -ex && pipenv install --deploy --system

COPY . /app
RUN DOCKERBUILD=1 python manage.py collectstatic --noinput
