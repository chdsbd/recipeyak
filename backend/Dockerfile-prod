FROM recipeyak/base@sha256:da2185c839f75241eee104adf24bab335ce392d607734a0a5c79f25848c00916
ENV PYTHONUNBUFFERD 1

# Install Poetry
# update circleci jobs if you change this version
RUN set -ex && python3 -m pip install poetry===0.12.11

# Install Application into container
RUN set -ex && mkdir -p /var/app

WORKDIR /var/app

# Adding dependency files
COPY pyproject.toml pyproject.toml
COPY poetry.lock poetry.lock

# Install our dev dependencies
RUN poetry install

COPY backend /var/app
ARG GIT_SHA
RUN poetry run yak build --api
