#!/usr/bin/env bash
set -ex

format() {
  if [ "$CI" ]; then
    ./.venv/bin/ruff format . --check
  else
    ./.venv/bin/ruff format .
  fi
}

ruff() {
 if [ "$CI" ]; then
    ./.venv/bin/ruff .
  else
    ./.venv/bin/ruff . --fix
  fi
}

migrations() {
  if [ "$CI" ]; then
    ./s/check_migrations
  fi
}

typecheck() {
    ./s/typecheck
}

main() {
  (trap 'kill 0' SIGINT; format & ruff & migrations & typecheck & wait)
}

main "$@"
